<img src="https://a0.awsstatic.com/libra-css/images/logos/aws_logo_smile_1200x630.png" alt="AWS" width="250"/>

# AWS Private Marketplace - Security Playbook <!-- omit in toc -->
## Capgroup Cybersecurity Control Alignment <!-- omit in toc -->

**Generated By:**  
[Rob Goss (RMG)](https://cgweb3/profile/RMG)
<br>
Security Engineering

**Last Update:** *07/21/2021*

## Table of Contents <!-- omit in toc -->
- [Overview](#overview)
- [Cloud Security Requirements](#Cloud-Security-Requirements)
  - [1. Private Marketplace administrative rights only assigned to Platform Design Team](#1-Private-Marketplace-administrative-rights-only-assigned-to-Platform-Design-Team)
  - [2. Private Marketplace utilizes VPC Endpoints to prevent public access](#2-Private-Marketplace-utilizes-VPC-Endpoints-to-prevent-public-access)
  - [3. Private Marketplace Experiences limited based on account need](#3-Private-Marketplace-Experiences-limited-based-on-account-need)
  - [4. IAM Policy Enforces Least Priviledge for Private Marketplace Resources](#1-IAM-Policy-Enforces-Least-Priviledge-for-Private-Marketplace-Resources)
  - [5. CloudTrail logging enabled for Private Marketplace](#5-CloudTrail-logging-enabled-for-Private-Marketplace)
  - [6. CloudWatch logging enabled for Private Marketplace](#6-CloudWatch-logging-enabled-for-Private-Marketplace)
- [Other Operational Expectations](#Other-Operational-Expectations)
  - [1. Private Marketplace Resources are tagged according to CG standards](#1-Private-Marketplace-Resources-are-tagged-according-to-CG-standards)
- [Endnotes](#Endnotes)
- [Capital Group Glossory](#Capital-Group-Glossory) 


## Overview
Private marketplace controls which products users in your AWS account, such as business users and engineering teams, can procure from AWS Marketplace. It is built on top of AWS Marketplace, and enables your administrators to create and customize curated digital catalogs of approved independent software vendors (ISVs) and products that conform to their in-house policies. Users in your AWS account can find, buy, and deploy approved products from your private marketplace, and ensure that all available products comply with your organization’s policies and standards.

Your private marketplace is shared across your organization. With AWS Organizations, you can create a series of accounts linked for permissions and payments. You can create one or more private marketplace experiences that are associated with one or more accounts in your organization, each with its own set of approved products. Your administrators can also apply company branding to each private marketplace experience with your company or team’s logo, messaging, and color scheme.

A private marketplace provides you with a broad catalog of products available in AWS Marketplace to choose from, in addition to fine-grained control of those products.

<img src="/docs/img/marketplace/example.png" width="800"><br>
<br><br>

## Cloud Security Requirements
<img src="/docs/img/Prevent.png" width="50">

### 1. Private Marketplace administrative rights only assigned to Platform Design Team

**Capital Group:** <br>

|Control Statement|Description|
|------|----------------------|
|Control Definition Needed|Control Definition Description Needed|

### 2. Private Marketplace utilizes VPC Endpoints to prevent public access

**Capital Group:** <br>

|Control Statement|Description|
|------|----------------------|
|[CS0012300](https://capitalgroup.service-now.com/cg_grc?sys_id=80df48c01bac20506a50beef034bcb47&table=sn_compliance_policy_statement&id=cg_grc_action_item_details&view=sp)|Cloud products and services must be deployed on private subnets and public access must be disabled for these services.|

**Why?**<br>
marketplace is a service that allows for the storage and processing of data on the AWS EC2 Service. Due to the possibility of sensitive data being stored and processed through marketplace, We need to make sure that this traffic is not transmitted directly over the Public Internet. 
<br>

**How?**<br>
Establishing a private connection between your virtual private cloud (VPC) and the Amazon marketplace API, you should create an interface VPC endpoint. You can use this connection to call the Amazon marketplace API from your VPC without sending traffic over the Internet. The endpoint provides secure connectivity to the Amazon marketplace API without requiring an Internet gateway (IGW), NAT instance, or virtual private network (VPN) connection.

Interface VPC endpoints are powered by AWS PrivateLink, a feature that enables private communication between AWS services using private IP addresses. To use AWS PrivateLink, create an interface VPC endpoint for Amazon marketplace in your VPC using the Amazon VPC console, API, or CLI. Doing this creates an elastic network interface in your subnet with a private IP address that serves Amazon marketplace API requests. You can also access a VPC endpoint from on-premises environments or from other VPCs using AWS VPN, AWS Direct Connect, or VPC peering. Below are the steps to implement Interface VPC Endpoints for marketplace:

**Creation of Interface VPC Endpoint**
  1. Open the Amazon VPC console at https://console.aws.amazon.com/vpc/, and choose Endpoints from the navigation pane at left.
  2. Choose Create Endpoint.
     - For Service category, choose AWS service. 
     - For Service Name, choose Config in your AWS Region (for example, `com.amazonaws.us-east-1.marketplace`).
     - Then choose the VPC, if it does not already exist follow this [link](https://github.com/open-itg/aws_runbooks/blob/master/vpc/RUNBOOK.md) for instructions on how to create a new VPC. 
     - Select a security group for AWS Config, if the default security group will not suffice then follow this [link](https://github.com/open-itg/aws_runbooks/blob/master/vpc/RUNBOOK.md) for instructions on how to create a new Security Group. 
     - Make sure that you `Enable` the Enable Private DNS Name check box.
     - Now add the appropriate `CG standard tags`.
  4. Click `Create Endpoint` to complete the process.
  <br><br>

### 3. Private Marketplace Experiences limited based on account need

**Capital Group:** <br>

|Control Statement|Description|
|------|----------------------|
|Control Definition Needed|Control Definition Description Needed|
<br><br>

### 4. IAM Policy Enforces Least Priviledge for Private Marketplace Resources

**Capital Group:** <br>

|Control Statement|Description|
|------|----------------------|
|Control Definition Needed|Control Definition Description Needed|
<br><br>

### 5. CloudTrail logging enabled for Private Marketplace

**Capital Group:** <br>

|Control Statement|Description|
|------|----------------------|
|Control Definition Needed|Control Definition Description Needed|

**What, Why & How?**

The EBS direct APIs service is integrated with AWS CloudTrail. CloudTrail is a service that provides a record of actions taken by a user, role, or an AWS service in the EBS direct APIs. CloudTrail captures StartSnapshot and CompleteSnapshot API calls for the EBS direct APIs as events. You can use the information collected by CloudTrail to determine the request that was made to the EBS direct APIs, the IP address from which the request was made, who made the request, when it was made, and additional details.

- A `default trail` should have been enabled through automation to allow for the continuous delivery of CloudTrail events to an Amazon Simple Storage Service (Amazon S3) bucket, including events for the EBS direct APIs. This will enable the forwarding of logs into Splunk for long term archival and reporting.
- Creation of non-default Cloud Trails should be avoided where possible as all EBS data should be logged and monitored though the aforementioned default trail.
<br><br>

### 6. CloudWatch logging enabled for Private Marketplace

**Capital Group:** <br>

|Control Statement|Description|
|------|----------------------|
|Control Definition Needed|Control Definition Description Needed|

**What, Why & How?**

The Marketplace Service allows for the collection of `CloudWatch Events`. EBS emits notifications based on Amazon CloudWatch Events for a variety of volume, snapshot, and encryption status changes. With CloudWatch Events, you can establish rules that trigger programmatic actions in response to a change in volume, snapshot, or encryption key state. 

For example, when a snapshot is created, you can trigger an AWS Lambda function to share the completed snapshot with another account or copy it to another Region for disaster-recovery purposes. CloudWatch Events are not logged to Splunk by default, and require that the account owner request this logging take place. Please see the [CloudWatch Runbook](https://github.com/open-itg/aws_runbooks/blob/master/cloudwatch/RUNBOOK.md) for further information.

Event Notification to consider enabling for EBS:
- EBS volume events
- EBS snapshot events
- EBS volume modification events
- EBS fast snapshot restore events

Utilizing CloudWatch event notifications for EBS can be useful in detecting anomolous activity and patterns in data access within the EBS storage service. It is recommended that CloudWatch is used to monitor any critical EBS volumes in use at CG.
<br><br>

## Other Operational Expectations
<img src="/docs/img/Operations.png" width="50">

### 1. Private Marketplace Resources are tagged according to CG standards

**Capital Group:** <br>

|Control Statement|Description|
|------|----------------------|
|Control Definition Needed|Control Definition Description Needed|

**What, Why & How?**

Tagging resources in the cloud is an easy way for teams to provide information related to who owns the resource, what the resource is used for, as well as other important information related to the deployment lifecycle of the resource. CG has mandated that all cloud resources are to be tagged with certain important for cross-team use. Although most of the mandatory tags will be added through automation, one should still check to make sure that all newly deployed recources have the appropriate tags attached. please see the documentation below for the latest tagging standards.

[CG Cloud Tagging Strategy](https://confluence.capgroup.com/display/HCEA/Resource+Tagging+standards)
<br><br>

## Endnotes
**Resources**<br>
1. https://aws.amazon.com/ebs/features/
2. https://aws.amazon.com/ebs/volume-types/
3. https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/AmazonEBS.html
4. https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSEncryption.html#encryption-parameters
5. https://aws.amazon.com/blogs/compute/must-know-best-practices-for-amazon-ebs-encryption/
6. https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ebs-cloud-watch-events.html
<br><br>

## Capital Group Glossory 
**Data** - Digital pieces of information stored or transmitted for use with an information system from which understandable information is derived. Items that could be considered to be data are: Source code, meta-data, build artifacts, information input and output.  
 
**Information System** - An organized assembly of resources and procedures for the collection, processing, maintenance, use, sharing, dissemination, or disposition of information. All systems, platforms, compute instances including and not limited to physical and virtual client endpoints, physical and virtual servers, software containers, databases, Internet of Things (IoT) devices, network devices, applications (internal and external), Serverless computing instances (i.e. AWS Lambda), vendor provided appliances, and third-party platforms, connected to the Capital Group network or used by Capital Group users or customers.

**Log** - a record of the events occurring within information systems and networks. Logs are composed of log entries; each entry contains information related to a specific event that has occurred within a system or network.

**Information** - communication or representation of knowledge such as facts, data, or opinions in any medium or form, including textual, numerical, graphic, cartographic, narrative, or audiovisual. 

**Cloud computing** - A model for enabling ubiquitous, convenient, on-demand network access to a shared pool of configurable computing resources (e.g., networks, servers, storage, applications, and services) that can be rapidly provisioned and released with minimal management effort or service provider interaction.

**Vulnerability**  - Weakness in an information system, system security procedures, internal controls, or implementation that could be exploited or triggered by a threat source. Note: The term weakness is synonymous for deficiency. Weakness may result in security and/or privacy risks.