<img src="https://a0.awsstatic.com/libra-css/images/logos/aws_logo_smile_1200x630.png" alt="AWS" width="250"/>

# AWS Kinesis - Security Playbook <!-- omit in toc -->
## NIST Cybersecurity Framework Alignment <!-- omit in toc -->

**Generated By:**  
[Rob Goss (RMG)](https://cgweb3/profile/RMG)
<br>
Security Engineering

**Last Update:** *03/22/2021*

## Table of Contents <!-- omit in toc -->
- [Overview](#overview)
- [Preventative Controls](#Preventative-Controls)
  - [1. Kinesis utilizes Interface VPC Endpoints](#1-Kinesis-utilizes-Interface-VPC-Endpoints)
  - [2. Kinesis utilizes IAM Roles to enforce least priviledge](#2-Kinesis-utilizes-IAM-Roles-to-enforce-least-priviledged)
  - [3. Kinesis connections are protected with TLS 1.2](#3-Kinesis-connections-are-protected-with-TLS-1-2)
  - [4. Kinesis data is encrypted using CG managed KMS Keys](#4-Kinesis-data-is-encrypted-using-CG-managed-KMS-Keys)
- [Detective Controls](#Detective-Controls)
- [Respond & Recover](#Respond/Recover)
- [Endnotes](#Endnotes)
- [Capital Group Glossory](#Capital-Group-Glossory) 

## Overview
Amazon Kinesis makes it easy to collect, process, and analyze real-time, streaming data so you can get timely insights and react quickly to new information. Amazon Kinesis offers key capabilities to cost-effectively process streaming data at any scale, along with the flexibility to choose the tools that best suit the requirements of your application. With Amazon Kinesis, you can ingest real-time data such as video, audio, application logs, website clickstreams, and IoT telemetry data for machine learning, analytics, and other applications. Amazon Kinesis enables you to process and analyze data as it arrives and respond instantly instead of having to wait until all your data is collected before the processing can begin. 

The core capabilities of AWS Kinesis are **Video Streams, Data Streams, Data Firehose** and **Data Analytics.** Currently this document's focus is primarily on Data Streams, Data Firehose and Data Analytics, which are described further below with examples:
 - **Data Streams:**<br>
 Amazon Kinesis Data Streams is a scalable and durable real-time data streaming service that can continuously capture gigabytes of data per second from hundreds of thousands of sources. This is the current CG implementation of Kinesis for integration with Splunk. <br>
 <img src="https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2018/08/16/diagram-how-it-works-kinesis-data-streams.249630c459ffe210d013ad06a0f6899ebea1304b.png" alt="AWS" width="500"/>

 - **Data Firehose:**<br>
 Amazon Kinesis Data Firehose is the easiest way to capture, transform, and load data streams into AWS data stores for near real-time analytics with existing business intelligence tools.
 <br>
 <img src="https://docs.aws.amazon.com/firehose/latest/dev/images/fh-flow-splunk.png" alt="AWS" width="500"/>

 - **Data Analytics:**<br>
 Amazon Kinesis Data Analytics is the easiest way to process data streams in real time with SQL or Apache Flink without having to learn new programming languages or processing frameworks.
 <br>
 <img src="https://i.stack.imgur.com/ORyFu.png" alt="AWS" width="500"/>
 <br><br>

## Preventative Controls
<img src="/docs/img/Prevent.png" width="50">

### 1. Kinesis utilizes Interface VPC Endpoints
The Kinesis Producer Library (KPL) and Kinesis Consumer Library (KCL) call AWS services like Amazon CloudWatch and Amazon DynamoDB using either public endpoints or private interface VPC endpoints, whichever are in use. Due to CG's current stance on Public Access, it is best to use Private VPC Endpoints and this section discusses the implementation thereof.
<br>

**NIST CSF:** <br>

|NIST Subcategory Control|Description|
|-----------|------------------------|
|PR.PT-4|Communications and control networks are protected|
|PR.PT-5|Mechanisms (e.g., failsafe, load balancing, hot swap) are implemented to achieve resilience requirements in normal and adverse situations|
|PR.AC-3|Remote access is managed|
|PR.AC-5|Network integrity is protected (e.g., network segregation, network segmentation)|
<br>

**Capital Group:** <br>

|Control Statement|Description|
|------|----------------------|
|6|Any AWS service used by CG should not be directly available to the Internet and the default route is always the CG gateway.|
|7|Use of AWS IAM accounts are restricted to CG networks.|
<br>

**Why?**<br>
 This deployment model allows the Kenesis Service to be only accessible by other services within the VPC and any internal services allowed through the associated Security Groups, which will be detailed later in this section.  This allows for the deployment to meet the stict CG public access policy for all cloud deployments. For example, if your KCL application is running in a VPC with DynamoDB interface with VPC endpoints enabled, calls between DynamoDB and your KCL application are flowing through the interface VPC endpoint.
<br>

**How?**<br>
This section details the implementation details for the Interface Endpoint configuration as it relates to Kinesis Data Streams and Firehose, allowing the service to meet the CG Public Access restrictions. This implementation is deployed in two steps outlined below:

1. **Creation of VPC Interface Endpoint**<br>
Geting started does not require changing the settings for your streams, producers, or consumers. One simply needs to create an interface VPC endpoint in order for your Kinesis Data Streams traffic from and to your Amazon VPC resources to start flowing through the interface VPC endpoint. Below is the process to create an Interface VPC Endpoint.
   - Navigate to the VPC Dashboard by searching VPC on the AWS Search bar as below:<br>
    <img src="/docs/img/kinesis/vpc.png" width="500"/>

   - Navigate to Endpoints and click Create Endpoint as below:<br>
    <img src="/docs/img/kinesis/create_endpoint.png" width="500"/>

   - Choose the VPC in which to create the interface endpoint, and provide the name of the AWS service, endpoint service, or AWS Marketplace service to which you're connecting.<br>
    <img src="/docs/img/kinesis/service.png" width="600"/>
    
   - Choose a subnet in your VPC to use the interface endpoint. We create an endpoint network interface in the subnet. An endpoint network interface is assigned a private IP address from the IP address range of your subnet, and keeps this IP address until the interface endpoint is deleted. You can specify more than one subnet in different Availability Zones (as supported by the service) to help ensure that your interface endpoint is resilient to Availability Zone failures. In that case, we create an endpoint network interface in each subnet that you specify.<br>
    <img src="/docs/img/kinesis/vpc_choose.png" width="600"/>

   - Next, specify the security groups to associate with the endpoint network interface. The security group rules control the traffic to the endpoint network interface from resources in your VPC and should provide the minimum access required for the service to function correctly. If a security group is not created and specified, the default security group will be applied, which may not correctly limit the access to / from the Kinesis service.<br>
    <img src="/docs/img/kinesis/sec_grp.png" width="600"/>

   - Next, enable private DNS for the endpoint so you can make requests to the Kinesis service using its default DNS hostname.<br>
    <img src="/docs/img/kinesis/dns.png" width="500"/>
   
   - The Next section discribes the Policy that should be applied to the Interface Endpoint. <br>

2. **Controlling Access to VPC Endpoints for Kinesis**
VPC endpoint policies enable you to control access by either attaching a policy to a VPC endpoint or by using additional fields in a policy that is attached to an IAM user, group, or role to restrict access to only occur via the specified VPC endpoint. These policies can be used to restrict access to specific streams to a specified VPC endpoint when used in conjunction with the IAM policies to only grant access to Kinesis data stream actions via the specified VPC endpoint.<br>
<img src="/docs/img/kinesis/policy.png" width="500"/>
<br>Above is the final screen configuration to be updated when creating a new VPC Endpoint, and allows for custom policy to control access, some custom policy examples can be seen below:

   - **VPC policy example: read-only access**
    ```
    {
    "Statement": [
        {
        "Sid": "ReadOnly",
        "Principal": "*",
        "Action": [
            "kinesis:List*",
            "kinesis:Describe*"
        ],
        "Effect": "Allow",
        "Resource": "*"
        }
    ]
    }    
   ```

   - **VPC policy example: restrict access to a specific Kinesis data stream**
    ```
    {
    "Statement": [
        {
        "Sid": "AccessToSpecificDataStream",
        "Principal": "*",
        "Action": "kinesis:*",
        "Effect": "Allow",
        "Resource": "arn:aws:kinesis:us-east-1:123456789012:stream/MyStream"
        }
    ]
    }
    ```
   In a future section on Kinesis and implementing IAM least priviledge, we will discuss other policy options to limit VPC Endpoint access for individual users and roles.

### 2. Kinesis utilizes IAM Roles to enforce least priviledge

`This Section will be updated soon.`

### 3. Kinesis connections are protected with TLS 1.2

`This Section will be updated soon.`

### 4. Kinesis data is encrypted using CG managed KMS Keys

`This Section will be updated soon.`

<br>

## Detective Controls
<img src="/docs/img/Detect.png" width="50">

### 1. Kenesis Resources are tagged according to CG standards

`This Section will be updated soon.`

### 2. CloudWatch logging enabled and sent to Splunk

`This Section will be updated soon.`

### 3. CloudTrail logging enabled and sent to Splunk

`This Section will be updated soon.`
<br><br>

## Respond/Recover
<img src="/docs/img/Monitor.png" width="50">

`This Section will be updated soon.`
<br><br>

## Endnotes
**Resources**<br>
1. 

<br>

## Capital Group Glossory 
**Data** - Digital pieces of information stored or transmitted for use with an information system from which understandable information is derived. Items that could be considered to be data are: Source code, meta-data, build artifacts, information input and output.  
 
**Information System** - An organized assembly of resources and procedures for the collection, processing, maintenance, use, sharing, dissemination, or disposition of information. All systems, platforms, compute instances including and not limited to physical and virtual client endpoints, physical and virtual servers, software containers, databases, Internet of Things (IoT) devices, network devices, applications (internal and external), Serverless computing instances (i.e. AWS Lambda), vendor provided appliances, and third-party platforms, connected to the Capital Group network or used by Capital Group users or customers.

**Log** - a record of the events occurring within information systems and networks. Logs are composed of log entries; each entry contains information related to a specific event that has occurred within a system or network.

**Information** - communication or representation of knowledge such as facts, data, or opinions in any medium or form, including textual, numerical, graphic, cartographic, narrative, or audiovisual. 

**Cloud computing** - A model for enabling ubiquitous, convenient, on-demand network access to a shared pool of configurable computing resources (e.g., networks, servers, storage, applications, and services) that can be rapidly provisioned and released with minimal management effort or service provider interaction.

**Vulnerability**  - Weakness in an information system, system security procedures, internal controls, or implementation that could be exploited or triggered by a threat source. Note: The term weakness is synonymous for deficiency. Weakness may result in security and/or privacy risks.

# Logs encrypted using CG KMS
# Enable TLS1.2 or higher for communication sessions
