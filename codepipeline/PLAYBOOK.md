<img src="https://a0.awsstatic.com/libra-css/images/logos/aws_logo_smile_1200x630.png" alt="AWS" width="250"/>

# AWS CodePipeline - Security Playbook <!-- omit in toc -->
## NIST Cybersecurity Framework Alignment <!-- omit in toc -->

**Generated By:**  
Freddie Wilson  
Tony DeMarco

*AWS Professional Services*

## Disclaimer
> The following applies to this document and all other documents, information, data, and responses (written or verbal) provided by Amazon Web Services, Inc. or any of its affiliates (collectively, "**AWS**") in connection with responding to this request and other related requests (collectively, this "**Response**"): This Response is expressly (a) informational only and provided solely for discussion purposes, (b) non-binding and not an offer to contract that can be accepted by any party, (c) provided "as is" with no representations or warranties whatsoever, and (d) based on AWS's current knowledge and may change at any time due to a variety of factors such as changes to your requirements or changes to AWS's service offerings. All obligations must be set forth in a separate, definitive written agreement between the parties. Neither party will have any liability for any failure or refusal to enter into a definitive agreement. All use of AWS's service offerings will be governed by the AWS Customer Agreement available at [http://aws.amazon.com/agreement/](http://aws.amazon.com/agreement/) (or other definitive written agreement between the parties governing the use of AWS's service offerings) (as applicable, the "**Agreement**"). If the parties have an applicable Nondisclosure Agreement ("**NDA**"), then the NDA will apply to all Confidential Information (as defined in the NDA) disclosed in connection with this Response. AWS's pricing is publicly available and subject to change in accordance with the Agreement. Pricing information (if any) provided in this Response is only an estimate and is expressly not a binding quote. Fees and charges will be based on actual usage of AWS services, which may vary from the estimates provided. Nothing in this Response will modify or supplement the terms of the Agreement or the NDA. No part of this Response may be disclosed without AWS's prior written consent. 

## Table of Contents <!-- omit in toc -->
- [Disclaimer](#disclaimer)
- [Overview](#overview)
- [Preventative Controls](#preventative-controls)
  - [1. Permissions within the service are established in line with individual need and least-privilege is enforced](#1-permissions-within-the-service-are-established-in-line-with-individual-need-and-least-privilege-is-enforced)
  - [2. Data is protected](#2-data-is-protected)
  - [3. Network infrastructure is protected from public and/or direct access](#3-network-infrastructure-is-protected-from-public-andor-direct-access)
- [Detective](#detective)
  - [1. Logging and Monitoring tools are in place and verified](#1-logging-and-monitoring-tools-are-in-place-and-verified)
- [Respond/Recover](#respondrecover)
  - [1. Utilize an event-based solution for automated incident response](#1-utilize-an-event-based-solution-for-automated-incident-response)
- [Endnotes](#endnotes)

## Overview
AWS provides a number of security features for AWS CodePipeline which help you comply with the NIST Cybersecurity Framework. The following playbook will outline what the AWS best practices are, how they align to NIST, and how to implement these best practices within your organization.

These NIST Controls and Subcategories are not applicable to this service: ID, PR.AC-2, PR.AT, PR.DS-3, PR.DS-7, PR.DS-8, PR.IP (Unless Stated), PR.MA, PR.PT-2, PR.PT-3, DE.AE-4, DE.AE-5, DE.CM-2, DE.CM-6, DE.DP, RS.RP, RS.CO, RS.MI, RS.IM, RC

## Preventative Controls
### 1. Permissions within the service are established in line with individual need and least-privilege is enforced
NIST CSF:
|NIST Subcategory Control|Description|
|-----------|------------------------|
|PR.AC-1|Identities and credentials are issued, managed, verified, revoked, and audited for authorized devices, users and processes|
|PR.AC-4|Access permissions and authorizations are managed, incorporating the principles of least privilege and separation of duties|
|PR.AC-7|Users, devices, and other assets are authenticated (e.g., single-factor, multi-factor) commensurate with the risk of the transaction (e.g., individuals’ security and privacy risks and other organizational risks)|
|PR.PT-3|The principle of least functionality is incorporated by configuring systems to provide only essential capabilities|

**Why?** Different users/services will require different levels of access within the service. Having clearly defined policies and limiters will ensure that a user is not able to manage pipelines in way that they shouldn't be able to.

**How?**
- Use IAM for appropriate user access restrictions
  - Leverage one or all of AWS managed policies:  
    - **AWSCodePipelineFullAccess** – Grants full access to CodePipeline
    - **AWSCodePipelineCustomActionAccess** – Grants permission to an IAM user to create custom actions in CodePipeline or integrate Jenkins resources for build or test actions
    - **AWSCodePipelineReadOnlyAccess** – Grants read-only access to CodePipeline
    - **AWSCodePipelineApproverAccess** – Grants permission to an IAM user to approve or reject a manual approval action
  - Limit sensitive functions (for both console and CLI access) to authorized individuals; at a minimum, Edit Pipeline and Create Pipeline.
- Leverage tags to restrict user access based on tag value.
- Employ MFA for sensitive S3 resources

For more information on setting up IAM policies for CodePipeline, including examples, see [Endnote 1](#endnote-1).

### 2. Data is protected
NIST CSF:
|NIST Subcategory Control|Description|
|-----------|------------------------|
|PR.DS-1|Data-at-rest is protected|
|PR.DS-2|Data-in-transit is protected|
|PR.DS-5|Protections against data leaks are implemented|
|PR.DS-6|Integrity checking mechanisms are used to verify software, firmware, and information integrity|
|PR.IP-1|A baseline configuration of information technology/industrial control systems is created and maintained incorporating security principles (e.g. concept of least functionality)|

**Why?** Data should be protected in-transit between the customer and AWS, as well as within AWS Services using NIST-approved encryption mechanism.

**How?** Data in CodePipeline is encrypted at rest using service-owned KMS keys. Code artifacts are stored in a customer-owned S3 bucket and encrypted with either the default AWS-managed KMS key or a customer-managed KMS key.  
All service to service communication is encrypted in transit using TLS.  
Use AWS Secrets Manager to rotate, manage, and retrieve database credentials, API keys, and other secrets referenced by CodePipeline.

### 3. Network infrastructure is protected from public and/or direct access
NIST CSF:
|NIST Subcategory Control|Description|
|-----------|------------------------|
|PR.PT-4|Communications and control networks are protected|
|PR.PT-5|Mechanisms (e.g., failsafe, load balancing, hot swap) are implemented to achieve resilience requirements in normal and adverse situations|
|PR.AC-3|Remote access is managed|
|PR.AC-5|Network integrity is protected (e.g., network segregation, network segmentation)|

**Why?** Controls provide reasonable assurance that AWS Services do not allow “public” access to customer data/service. (“Public access” defined as access to services or data (resources) by any entity or network not “owned” by the customer.)  
Controls provide reasonable assurance that direct access (with provided credentials) is not allowed to the AWS environment (trusted third party access to customer resources must flow through an Intermediary).

**How?** CodePipeline supports Amazon VPC endpoints powered by AWS PrivateLink, an AWS technology that facilitates private communication between AWS services using an elastic network interface with private IP addresses. This means you can connect directly to CodePipeline through a private endpoint in your VPC, keeping all traffic inside your VPC and the AWS network.  
For more information, see [Endnote 2](#endnote-2).

## Detective
### 1. Logging and Monitoring tools are in place and verified
NIST CSF:
|NIST Subcategory Control|Description|
|-----------|------------------------|
|DE.AE-1|A baseline of network operations and expected data flows for users and systems is established and managed|
|DE.AE-2|Detected events are analyzed to understand attack targets and methods|
|DE.AE-3|Event data are collected and correlated from multiple sources and sensors|
|DE.CM-1|The network is monitored to detect potential cybersecurity events|
|DE.CM-3|Personnel activity is monitored to detect potential cybersecurity events|
|DE.CM-7|Monitoring for unauthorized personnel, connections, devices, and software is performed|  

**Why?** In the event of an investigation, having logs to reference or analyze will help determine root causes. These tools also can be leveraged by performance monitors to find any gaps or areas of improvement within the service.

**How?** Leverage AWS CloudTrail for a record of actions taken by a user, role, or an AWS service in AWS CodePipeline. Using the information collected by CloudTrail, you can determine the request that was made, the IP address from which the request was made, who made the request, when it was made, and additional details.  
Monitor Amazon CloudWatch to understand and improve performance of CodePipeline.  
Use file integrity validation to evidence whether a log file was modified, deleted, or unchanged after CloudTrail delivered it.

## Respond/Recover
### 1. Utilize an event-based solution for automated incident response
NIST CSF:
|NIST Subcategory Control|Description|
|-----------|------------------------|
|RS.AN-1|Notifications from detection systems are investigated|
|RS.AN-2|The impact of the incident is understood|
|RS.AN-3|Forensics are performed|
|RS.AN-4|Incidents are categorized consistent with response plans|
|RS.AN-5|Processes are established to receive, analyze and respond to vulnerabilities disclosed to the organization from internal and external sources (e.g. internal testing, security bulletins, or security researchers)|

**Why?** Using an event-based solution, you can automatically report and respond to incidents of almost any kind, including ECR actions, Image Scans, or API Calls via CloudTrail.

**How?** For various incident types, an appropriate response rule should be determined and added to Amazon EventBridge (previously CloudWatch Events). Depending on the organization's Incident Response Plan, there may be need for human interaction in some cases, or fully automated remediation in other cases.  
A couple examples of events to report or respond to would include; The deletion of a pipeline, A change to the Action step of a Pipeline, or The creation of a pipeline with an unsanctioned external connection.  
See [Endnote 3](#endnote-3) for more information.

## Endnotes
### Endnote 1 <!-- omit in toc -->
[https://docs.aws.amazon.com/codepipeline/latest/userguide/security_iam_service-with-iam.html](https://docs.aws.amazon.com/codepipeline/latest/userguide/security_iam_service-with-iam.html)
### Endnote 2 <!-- omit in toc -->
[https://docs.aws.amazon.com/codepipeline/latest/userguide/vpc-support.html](https://docs.aws.amazon.com/codepipeline/latest/userguide/vpc-support.html)
### Endnote 3 <!-- omit in toc -->
[https://docs.aws.amazon.com/codepipeline/latest/userguide/detect-state-changes-cloudwatch-events.html](https://docs.aws.amazon.com/codepipeline/latest/userguide/detect-state-changes-cloudwatch-events.html)

