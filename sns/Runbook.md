<img src="https://a0.awsstatic.com/libra-css/images/logos/aws_logo_smile_1200x630.png" alt="AWS" width="250"/>

# Simple Notification Service (SNS) - Security Playbook <!-- omit in toc -->
## NIST Cybersecurity Framework Alignment <!-- omit in toc -->

**Generated By:**  
[Rob Goss (RMG)](https://cgweb3/profile/RMG)
<br>
Security Engineering

**Last Update:** *01/25/2021*

## Table of Contents <!-- omit in toc -->
- [Overview](#overview)
- [Preventative Controls](#Preventative-Controls)
  - [1. SNS Deployed with VPC Endpoints](#1-SNS-Deployed-with-VPC-Endpoints)
  - [2. SNS Deployed with Encryption using CG Managed Keys](#2-SNS-Deployed-with-Encryption-using-CG-Managed-Keys)
  - [3. SNS Deployed with appropriate permissions to enforce least priviledge](#3-SNS-Deployed-with-appropriate-permissions-to-enforce-least-priviledge)
- [Detective Controls](#Detective-Controls)
  - [1. First Item](#1-First-Item)
  - [2. CloudTrail logging enabled and sent to Splunk](#2-CloudTrail-logging-enabled-and-sent-to-Splunk)
  - [3. CloudWatch logging enabled](#3-CloudWatch-logging-enabled)
- [Respond & Recover](#Respond/Recover)
- [Endnotes](#Endnotes)
- [Capital Group Glossory](#Capital-Group-Glossory) 

## Overview
AWS Simple Notification Service (SNS) is a fully managed push notifications service that is cost effective, fast, and flexible. If provides you with the ability to send individual messages or a number of messages to a large number of recipients. SNS makes it easy to send notifications to email recipients, mobile device users worldwide, or messages to other distributed services.

This is also known as Event-driven computing, a model in which subscriber services automatically perform work in response to events triggered by publisher services. This paradigm can be applied to automate workflows while decoupling the services that collectively and independently work to fulfil these workflows.

Amazon SNS is an event-driven computing hub that has native integration with a wide variety of AWS event sources (including Amazon EC2, Amazon S3, and Amazon RDS) and AWS event destinations (including Amazon SQS, and Lambda). The figure below shows how SNS can be used for event-driven computing:

<img src="/docs/img/sns/sns_example.png" width="800">
<br>

## Preventative Controls
<img src="/docs/img/Prevent.png" width="50"><br>

### 1. SNS Deployed with VPC Endpoints
To publish messages to your Amazon SNS topics from a private VPC, we first need to create an interface VPC endpoint. Then, you can publish messages to your topics while keeping the traffic within the network that you manage with the VPC.  This process will be explained below:
<br>

**NIST CSF:** <br>

|NIST Subcategory Control|Description|
|-----------|------------------------|
|PR.PT-4|Communications and control networks are protected|
|PR.PT-5|Mechanisms (e.g., failsafe, load balancing, hot swap) are implemented to achieve resilience requirements in normal and adverse situations|
|PR.AC-3|Remote access is managed|
|PR.AC-5|Network integrity is protected (e.g., network segregation, network segmentation)|
<br>

**Capital Group:** <br>

|Control Statement|Description|
|------|----------------------|
|6|Any AWS service used by CG should not be directly available to the Internet and the default route is always the CG gateway.|
|7|Use of AWS IAM accounts are restricted to CG networks.|
<br>

**Why?**

This deployment model allows SNS to be only accessible by other services within the VPC and any internal services allowed through the associated Security Groups.  This allows for the deployment to meet the stict CG public access policy for all cloud deployments.

**How?**

To connect an existing VPC to Amazon SNS, you define an interface VPC endpoint. After you add the endpoint, you can log in to the Amazon EC2 instance in your VPC, and from there you can use the Amazon SNS API. You can publish messages to the topic, and the messages are published privately. They stay within the AWS network, and they don't travel the public internet. If there are no existing VPC's one will need to be created prior to the steps below.

**NOTE:** Never use the 'Default' VPC when deploying any services as this has public access and assigns public IP addressing by default.

1. Open the Amazon VPC console at https://console.aws.amazon.com/vpc/.

2. In the navigation menu on the left, choose Endpoints.

3. Choose 'Create Endpoint'.

4. On the Create Endpoint page, for Service category, keep the default choice of AWS services.

5. For Service Name, choose the service name for Amazon SNS.<br>
*The service names vary based on the chosen region. For example, if you chose US East (N. Virginia), the service name is com.amazonaws.us-east-1.sns.*<br>
<img src="/docs/img/sns/endpoint.png" width="800">

6. For VPC, choose the VPC that you want to host the Endpoint.<br>
<img src="/docs/img/sns/vpc.png" width="600">

7. For Subnets, choose the subnets that are assigned to the selected VPC, in the subnet ID.<br>
<img src="/docs/img/sns/subnets.png" width="600">

8. For Enable Private DNS Name, select Enable for this endpoint.

9. For Security group, choose Select security group, and choose one of the default security groups, if the access on these is to broad, a new security group should be created with least privilege based on need.<br>
<img src="/docs/img/sns/sec_group.png" width="600">

10. Choose 'Create endpoint'. The Amazon VPC console confirms that a VPC endpoint was created.<br>
<img src="/docs/img/sns/vpce_done.png" width="800">

<br>

### 2. SNS Deployed with Encryption using CG Managed Keys
`This Section will be updated soon.`<br><br>


### 3. SNS Deployed with appropriate permissions to enforce least priviledge
Simple Notification Service (SNS) enables applications, end-users, and devices to instantly send and receive notifications. SNS allows you send individual messages or to fan-out messages to large numbers of recipients to mobile device users, email recipients, or to other distributed services. <br>

**NIST CSF:** <br>

|NIST Subcategory Control|Description|
|-----------|------------------------|
|PR.AC-1|Identities and credentials are issued, managed, verified, revoked, and audited for authorized devices, users and processes|
|PR.AC-4|Access permissions and authorizations are managed, incorporating the principles of least privilege and separation of duties|
|PR.AC-7|Users, devices, and other assets are authenticated (e.g., single-factor, multi-factor) commensurate with the risk of the transaction (e.g., individuals’ security and privacy risks and other organizational risks)|
|PR.PT-3|The principle of least functionality is incorporated by configuring systems to provide only essential capabilities|
<br>

**Capital Group:** <br>

|Control Statement|Description|
|------|----------------------|
|5|AWS IAM User accounts are only to be created for use by services or products that do not support IAM Roles. Services are not allowed to create local accounts for human use within the service. All human user authentication will take place within CG’s Identity Provider.|
|8|AWS IAM User secrets, including passwords and secret access keys, are to be rotated every 90 days. Accounts created locally within any service must also have their secrets rotated every 90 days.|
|10|Administrative access to AWS resources will have MFA enabled|
<br>

**Why?**

Application or Infrastucture teams should have the capability to implement levels of privilege and have authorization mechanisms in place to enforce the separation of privileges, mandate multi-factor authentication, and similar protections based on sensitivity.
<br>

**How?**

AWS users have the ability to control who has access to the SNS Topics, and which permissions they are granted. The followin information will aim to provide examples of how to limit the scope of access that an SNS topic allows.

Permissions can be currently be granted for these actions: ListSubscriptionsByTopic, Subscribe, DeleteTopic, GetTopicAttributes, Publish, RemovePermission, AddPermission, Receive, and SetTopicAttributes.

Users can also generate custom SNS Topic policies. Using a policy, you can configure one of the following types of users to access a SNS topic:

    - Only me *(Topic Owner Ownly)*
    - Everyone *(Does not comply with CG Standards)*
    - Specific AWS users *(Alows for users other than Topic Owner)*

Below are some key access items to be sure to include:
1. Deny SNS Cross Account Access
2. Deny SNS Topic Everyone has Publish / Subscribe Access
<br><br>

## Detective Controls
<img src="/docs/img/Detect.png" width="50"><br>

`This Section will be updated soon.`

<br>

## Respond/Recover
<img src="/docs/img/Monitor.png" width="50"><br>

`This Section will be updated soon.`

<br>

## Endnotes
**Resources**<br>
1. https://aws.amazon.com/sns/features/
2. https://docs.aws.amazon.com/sns/latest/dg/welcome.html
3. https://docs.aws.amazon.com/sns/latest/dg/sns-vpc-tutorial.html

<br>

## Capital Group Glossory 
**Data** - Digital pieces of information stored or transmitted for use with an information system from which understandable information is derived. Items that could be considered to be data are: Source code, meta-data, build artifacts, information input and output.  
 
**Information System** - An organized assembly of resources and procedures for the collection, processing, maintenance, use, sharing, dissemination, or disposition of information. All systems, platforms, compute instances including and not limited to physical and virtual client endpoints, physical and virtual servers, software containers, databases, Internet of Things (IoT) devices, network devices, applications (internal and external), Serverless computing instances (i.e. AWS Lambda), vendor provided appliances, and third-party platforms, connected to the Capital Group network or used by Capital Group users or customers.

**Log** - a record of the events occurring within information systems and networks. Logs are composed of log entries; each entry contains information related to a specific event that has occurred within a system or network.

**Information** - communication or representation of knowledge such as facts, data, or opinions in any medium or form, including textual, numerical, graphic, cartographic, narrative, or audiovisual. 

**Cloud computing** - A model for enabling ubiquitous, convenient, on-demand network access to a shared pool of configurable computing resources (e.g., networks, servers, storage, applications, and services) that can be rapidly provisioned and released with minimal management effort or service provider interaction.

**Vulnerability**  - Weakness in an information system, system security procedures, internal controls, or implementation that could be exploited or triggered by a threat source. Note: The term weakness is synonymous for deficiency. Weakness may result in security and/or privacy risks.
## Configure with dedicated AWS IP address groups, provide to TSO Messaging team

## Configure with 'cgaws.capgroup.com' email sub-domain

## Only allow messages to be sent to CG Exchange platform

## Enable TLS 1.2 or higher for communication sessions

## CloudTrail logging enabled and sent to Splunk

## CloudWatch logging enabled and sent to Splunk
