<img src="https://a0.awsstatic.com/libra-css/images/logos/aws_logo_smile_1200x630.png" alt="AWS" width="250"/>

# AWS Severless Application Repository - Security Runbook <!-- omit in toc -->
## Capgroup Cybersecurity Control Alignment <!-- omit in toc -->

**Generated By:**  
[Josh Linus (JHZL)](https://cgweb3/profile/JHZL)  
Security Engineering

**Last Update:** *06/14/2021*

## Table of Contents <!-- omit in toc -->  
- [Overview](#overview)
- [Preventative Controls](#preventative-controls)
  - [1. Implement access controls to enforce least privilege](#1-preventative-item-1)
  - [2. Data is protected at-rest and in-transit](#2-preventative-item-2)
  - [3. SAR Utilizes TLS 1.2 to secure data in transit](#3-preventative-item-3)
- [Detective](#detective)
  - [1. AWS CloudTrail Logging enabled](#1-detective-item-1)
  - [2. Detective Item 2](#2-detective-item-2)
  - [3. Detective Item 3](#3-detective-item-3)
- [Respond/Recover](#respondrecover)
  - [1. Respond/Recover Item 1](#1-respondrecover-item-1)
  - [2. Respond/Recover Item 2](#2-respondrecover-item-2)
  - [3. Respond/Recover Item 3](#3-respondrecover-item-3)
- [Endnotes](#endnotes)

## Overview

AWS Serverless Repository is a managed repository that enables teams and individual developers to find, store and share reusable applications. Uploading your application to the severless repository is as simple as uploading the code, along with a AWS SAM template. Integration with AWS Identity and Access Management(IAM) provides resource level control of each application, enabling you to publically or privately share applications and thier permissions as needed.

The AWS Serverless Application Repository is deeply integrated with the AWS Lambda console. To use an application, you simply choose it, configure any required fields, and deploy it with a few clicks.

<img src="SeverlessApp_example.png" max width="800">   
 
### Benefits & Features
 - Easily Manage Applications
 - Reuses Applcations, No need to Rebuild
 - Ensure Best Practices

**NOTE:**
>'Serverless Repository is an AWS Managed service offering, the underlying Infrastructure including Network and Compute resources are all managed by AWS as explained in the Shared Responsibility Model. Due to this fact, CG's standard public access controls cannot be applied and the application of appropriate controls to keep the service from external or public accessibility falls on AWS. The IAM and Encryption controls however remain CG's responsibility and are listed in the sections below.' 

<br>  

## Preventative Controls
<img src="Prevent.png" width="50"> 

### 1. Publishers can set application permissions to enforce least privilege model  
<!-- NIST CSF:  
|NIST Subcategory Control|Description|
|-----------|------------------------|
|PR.AC-1|Identities and credentials are issued, managed, verified, revoked, and audited for authorized devices, users and processes|
|PR.AC-3|Remote access is managed|
|PR.AC-4|Access permissions and authorizations are managed, incorporating the principles of least privilege and separation of duties|
|PR.AC-6|Identities are proofed and bound to credentials and asserted in interactions|
|PR.AC-7|Users, devices, and other assets are authenticated (e.g., single-factor, multi-factor) commensurate with the risk of the transaction (e.g., individuals’ security and privacy risks and other organizational risks)|

Capital Group:
|Control Statement|Description|
|------|----------------------|
|5|AWS IAM User accounts are only to be created for use by services or products that do not support IAM Roles. Services are not allowed to create local accounts for human use within the service. All human user authentication will take place within CG’s Identity Provider.|
|8|AWS IAM User secrets, including passwords and secret access keys, are to be rotated every 90 days. Accounts created locally within any service must also have their secrets rotated every 90 days.|
|10|Administrative access to AWS resources will have MFA enabled|
-->
**Why?**  
AWS Serverless Application Repository application policies are used to by publishers to grant premissions to consumers when they deploy thier applications. Publishers can set application permissions to the following three categories:
 - **Private** – Applications that were created with the same account, and haven't been shared with any other account. Only consumers that share your AWS account have permission to deploy private applications.
 - **Privately shared** – Applications that the publisher has explicitly shared with a specific set of AWS accounts, or with AWS accounts in an AWS organization. Consumers have permission to deploy applications that have been shared with their AWS account or AWS organization.
 - **Publicly shared** – Applications that the publisher has shared with everyone. All consumers have permission to deploy any publicly shared application.  

When working with AWS CLI you can also set permisions for the following actions:

|Action|Description|
|------|----------------------|
|GetApplication|Grants permission to view information about the application|
|CreateCloudFormationChangeSet|Grants permission for the application to be deployed|	
|CreateCloudFormationTemplate|Grants permission to create an AWS CloudFormation template for the application|
|ListApplicationVersions|Grants permission to list the versions of the application|
|ListApplicationDependencies|Grants permission to list the list applications that are nested in the containing application|
|SearchApplications|Grants permission for the application to be searched for|
|Deploy|This action enables all the actions listed earlier in the table. That is, it grants permission for the application to be viewed, for it to be deployed, for versions to be listed, and for it to be searched for|


**NOTE:**
>After you have published an application to the AWS Serverless Application Repository, by default it is set to **private**.  

**How?**     
### **Private**
1. *Make an Application Private*  
You can make an application private, so it's not shared with anyone and can only be deployed by the AWS account that owns it. To do so, you clear out the principals and actions from the policy, which also removes permissions from other accounts within your AWS organization from deploying your application.
```
aws serverlessrepo put-application-policy \
--region region \
--application-id application-arn \
--statements '[]'
```
<br>

### **Privately shared**
1. *Share an Application with Another Account*   
To share an application with another specific account, but keep it from being shared with others, you specify the AWS account ID that you want to share with as the principal. This is also known as setting the application to privately shared. To do this, use the following AWS CLI command.
```
aws serverlessrepo put-application-policy \
--region region \
--application-id application-arn \
--statements Principals=account-id,Actions=Deploy
```
2. *Specifying Multiple Accounts and Permissions*  
You can grant multiple permissions, and you can grant them to more than one AWS account at a time. To do this, you specify lists as the principal and actions, as shown in the following example.
```
aws serverlessrepo put-application-policy \
--region region \
--application-id application-arn \
--statements Principals=account-id-1,account-id-2,Actions=GetApplication,CreateCloudFormationChangeSet
```
3. *Share an Application with All Accounts in an AWS Organization*  
Permissions can be granted to all users within an AWS organization. You do this by specifying your organization ID, as in the following example.
```
aws serverlessrepo put-application-policy \
--region region \
--application-id application-arn \
--statements Principals=*,PrincipalOrgIDs=org-id,Actions=Deploy,UnshareApplication
```
4. *Sharing an Application with Some Accounts in an AWS Organization*  
Permissions can be granted to specific accounts within an AWS organization. You do this by specifying a list of AWS accounts as the principal, and your organization ID, as in the following example.
```
aws serverlessrepo put-application-policy \
--region region \
--application-id application-arn \
--statements Principals=account-id-1,account-id-2,PrincipalOrgIDs=org-id,Actions=Deploy,UnshareApplication
```

<br>

### **Publicly Shared** 
1. *Share an Application Publicly*   
To make an application public, you share it with everyone by specifying "*" as the principal, as in the following example. Applications that are shared publicly are available in all Regions.  
```
aws serverlessrepo put-application-policy \
--region region \
--application-id application-arn \
--statements Principals=*,Actions=Deploy
```
Resource based Policies: https://docs.aws.amazon.com/serverlessrepo/latest/devguide/security_iam_resource-based-policy-examples.html

<br>

### 2. Data is protected at-rest and in-transit
NIST CSF:
|NIST Subcategory Control|Description|
|-----------|------------------------|
|PR.DS-1|Data-at-rest is protected|
|PR.DS-2|Data-in-transit is protected|
|||
|||

Capital Group:
|Control Statement|Description|
|------|----------------------|
|1||
|2||
|||

**Why?**   
`This Section will be updated soon.`   
**How?**   
`This Section will be updated soon.` 



## Detective
<img src="Detect.png" width="50">

`This Section will be updated soon.`  

## Respond/Recover
<img src="Monitor.png" width="50">

`This Section will be updated soon.`

## Endnotes
**Resources**
### What is this Service:  
https://docs.aws.amazon.com/serverlessrepo/latest/devguide/what-is-serverlessrepo.html  

### Resource Based Policies: 
https://docs.aws.amazon.com/serverlessrepo/latest/devguide/security_iam_resource-based-policy-examples.html 


## Capital Group Control Statements
1. All Data-at-rest must be encrypted and use a CG BYOK encryption key.
2. All Data-in-transit must be encrypted using certificates using CG Certificate Authority.
3. Keys storied in a Key Management System (KMS) should be created by Capital Group's hardware security module (HSM) and are a minimum of AES-256.
4. AWS services should have logging enabled and those logs delivered to CloudTrail or Cloud Watch.
5. Local AWS IAM accounts are restricted to services and no user accounts are to be provisioned including IaaS resources.
6. Any AWS service used by CG should not be directly available to the Internet and the default route is always the CG gateway.
7. Use of AWS IAM accounts are restricted to CG networks.
8. Local IAM secrets are rotated every 90 days, including accounts IaaS resources.
9. Encryption keys are rotated annually.
10. Root accounts must have 2FA/MFA enabled.

## Capital Group Glossory 
**Data** - Digital pieces of information stored or transmitted for use with an information system from which understandable information is derived. Items that could be considered to be data are: Source code, meta-data, build artifacts, information input and output.  
 
**Information System** - An organized assembly of resources and procedures for the collection, processing, maintenance, use, sharing, dissemination, or disposition of information. All systems, platforms, compute instances including and not limited to physical and virtual client endpoints, physical and virtual servers, software containers, databases, Internet of Things (IoT) devices, network devices, applications (internal and external), Serverless computing instances (i.e. AWS Lambda), vendor provided appliances, and third-party platforms, connected to the Capital Group network or used by Capital Group users or customers.

**Log** - a record of the events occurring within information systems and networks. Logs are composed of log entries; each entry contains information related to a specific event that has occurred within a system or network.

**Information** - communication or representation of knowledge such as facts, data, or opinions in any medium or form, including textual, numerical, graphic, cartographic, narrative, or audiovisual. 

**Cloud computing** - A model for enabling ubiquitous, convenient, on-demand network access to a shared pool of configurable computing resources (e.g., networks, servers, storage, applications, and services) that can be rapidly provisioned and released with minimal management effort or service provider interaction.

**Vulnerability**  - Weakness in an information system, system security procedures, internal controls, or implementation that could be exploited or triggered by a threat source. Note: The term weakness is synonymous for deficiency. Weakness may result in security and/or privacy risks.