<img src="https://a0.awsstatic.com/libra-css/images/logos/aws_logo_smile_1200x630.png" alt="AWS" width="250"/>

# AWS Severless Application Repository - Security Runbook <!-- omit in toc -->
## Capgroup Cybersecurity Control Alignment <!-- omit in toc -->

**Generated By:**  
[Josh Linus (JHZL)](https://cgweb3/profile/JHZL)  
Security Engineering

**Last Update:** *06/23/2021*

## Table of Contents <!-- omit in toc -->  
- [Overview](#overview)
- [Preventative Controls](#preventative-controls)
  - [1. Publishers must set application permissions to private or privately shared with CG organization accounts](#1-Publishers-must-set-application-permissions-to-private-or-privately-shared-with-CG-organization-accounts)
  - [2. SAR Data is protected at-rest](#2-SAR-Data-is-protected-at-rest)
  - [3. SAR Utilizes TLS 1.2 to secure data in transit](#3-SAR-Utilizes-TLS-1-2-to-secure-data-in-transit)
- [Detective](#detective)
  - [1. SAR Resources are tagged according to CG standards](#1-SAR-Resources-are-tagged-according-to-CG-standards)
  - [2. CloudTrail logging enabled and sent to Splunk](#2-CloudTrail-logging-enabled-and-sent-to-Splunk)
  - [3. CloudWatch logging enabled and sent to Splunk](#3-CloudWatch-logging-enabled-and-sent-to-Splunk)
- [Respond & Recover](#Respond/Recover)
- [Endnotes](#Endnotes)
- [Capital Group Glossory](#Capital-Group-Glossory) 
<br><br>

## Overview
AWS Serverless Repository is a managed repository that enables teams and individual developers to find, store and share reusable applications. Uploading your application to the severless repository is as simple as uploading the code, along with a AWS SAM template. Integration with AWS Identity and Access Management(IAM) provides resource level control of each application, enabling you to publically or privately share applications and thier permissions as needed.

The AWS Serverless Application Repository is deeply integrated with the AWS Lambda console. To use an application, you simply choose it, configure any required fields, and deploy it with a few clicks.

<img src="SeverlessApp_example.png" max width="800">   
 
### Benefits & Features
 - Easily Manage Applications
 - Reuses Applcations, No need to Rebuild
 - Ensure Best Practices

**NOTE:**
>Serverless Repository is an AWS Managed service offering, the underlying Infrastructure including Network and Compute resources are all managed by AWS as explained in the Shared Responsibility Model. Due to this fact, CG's standard public access controls cannot be applied and the application of appropriate controls to keep the service from external or public accessibility falls on AWS. The IAM and Encryption controls however remain CG's responsibility and are listed in the sections below.

<br><br> 

## Preventative Controls
<img src="Prevent.png" width="50"> 

### 1. Publishers must set application permissions to private or privately shared with CG organization accounts
<br>

**Capital Group Controls:** 
<br>
|Control Statement|Description|
|------|----------------------|
|[CS0012300](https://capitalgroup.service-now.com/cg_grc?sys_id=80df48c01bac20506a50beef034bcb47&table=sn_compliance_policy_statement&id=cg_grc_action_item_details&view=sp)|Cloud products and services must be deployed on private subnets and public access must be disabled for these services.|

**Why?**  
AWS Serverless Application Repository application policies are used to by publishers to grant premissions to consumers when they deploy thier applications. Publishers can set application permissions to the following three categories:
 - **Private** – Applications that were created with the same account, and haven't been shared with any other account. Only consumers that share your AWS account have permission to deploy private applications.
 - **Privately shared** – Applications that the publisher has explicitly shared with a specific set of AWS accounts, or with AWS accounts in an AWS organization. Consumers have permission to deploy applications that have been shared with their AWS account or AWS organization.
 - **Publicly shared** – Applications that the publisher has shared with everyone. All consumers have permission to deploy any publicly shared application. *Do Not Use*  

When working with AWS CLI you can also set permisions for the following actions:

|Action|Description|
|------|----------------------|
|GetApplication|Grants permission to view information about the application|
|CreateCloudFormationChangeSet|Grants permission for the application to be deployed|	
|CreateCloudFormationTemplate|Grants permission to create an AWS CloudFormation template for the application|
|ListApplicationVersions|Grants permission to list the versions of the application|
|ListApplicationDependencies|Grants permission to list the list applications that are nested in the containing application|
|SearchApplications|Grants permission for the application to be searched for|
|Deploy|This action enables all the actions listed earlier in the table. That is, it grants permission for the application to be viewed, for it to be deployed, for versions to be listed, and for it to be searched for|


**NOTE:**
>After you have published an application to the AWS Serverless Application Repository, by default it is set to **private**. It is imperative that your application permissons only be private or privately shared with our CG AWS accounts. This is because sccording to CG security controls, applications and databases containing sensitive information must be isolated and not accessible from unapproved segments of the network.They must be compartmentalized to safe areas with defined trust boundaries. 

<br>

**How?**     
### Private
1. *Make an Application Private*  
You can make an application private, so it's not shared with anyone and can only be deployed by the AWS account that owns it. To do so, you clear out the principals and actions from the policy, which also removes permissions from other accounts within your AWS organization from deploying your application.
```
aws serverlessrepo put-application-policy \
--region region \
--application-id application-arn \
--statements '[]'
```
<br>

### Privately shared
1. *Share an Application with Another Account*   
To share an application with another specific account, but keep it from being shared with others, you specify the AWS account ID that you want to share with as the principal. This is also known as setting the application to privately shared. To do this, use the following AWS CLI command.
```
aws serverlessrepo put-application-policy \
--region region \
--application-id application-arn \
--statements Principals=account-id,Actions=Deploy
```
2. *Specifying Multiple Accounts and Permissions*  
You can grant multiple permissions, and you can grant them to more than one AWS account at a time. To do this, you specify lists as the principal and actions, as shown in the following example.
```
aws serverlessrepo put-application-policy \
--region region \
--application-id application-arn \
--statements Principals=account-id-1,account-id-2,Actions=GetApplication,CreateCloudFormationChangeSet
```
3. *Share an Application with All Accounts in an AWS Organization*  
Permissions can be granted to all users within an AWS organization. You do this by specifying your organization ID, as in the following example.
```
aws serverlessrepo put-application-policy \
--region region \
--application-id application-arn \
--statements Principals=*,PrincipalOrgIDs=org-id,Actions=Deploy,UnshareApplication
```
4. *Sharing an Application with Some Accounts in an AWS Organization*  
Permissions can be granted to specific accounts within an AWS organization. You do this by specifying a list of AWS accounts as the principal, and your organization ID, as in the following example.
```
aws serverlessrepo put-application-policy \
--region region \
--application-id application-arn \
--statements Principals=account-id-1,account-id-2,PrincipalOrgIDs=org-id,Actions=Deploy,UnshareApplication
```

<br>

### <span style="color:red">Avoid Publicly Shared Applications</span>
1. *Avoid Sharing an Application Publicly*   
An application is made public, when you only specify "*" as the principal, as in the following example. Applications should never be shared publicly, and this permisson should be **avoided**. Applications are private by default, but always check to make sure that no unwanted changes were made.

<span style="color:red">**Avoid the Following:**</span>
```
aws serverlessrepo put-application-policy \
--region region \
--application-id application-arn \
--statements Principals=*,Actions=Deploy
```
Resource based Policies: 
https://docs.aws.amazon.com/serverlessrepo/latest/devguide/security_iam_resource-based-policy-examples.html

<br>

## Detective Controls
<img src="/docs/img/Detect.png" width="50">

### 1. SAR Resources are tagged according to CG standards
`This Section will be updated soon.`

### 2. CloudTrail logging enabled and sent to Splunk
`This Section will be updated soon.`

### 3. CloudWatch logging enabled and sent to Splunk
`This Section will be updated soon.`
<br><br>

## Respond/Recover
<img src="Monitor.png" width="50">

`This Section will be updated soon.`
<br><br>

## Endnotes
**Resources**
1.  https://docs.aws.amazon.com/serverlessrepo/latest/devguide/what-is-serverlessrepo.html  
2. https://docs.aws.amazon.com/serverlessrepo/latest/devguide/security_iam_resource-based-policy-examples.html 
<br><br>

## Capital Group Glossory 
**Data** - Digital pieces of information stored or transmitted for use with an information system from which understandable information is derived. Items that could be considered to be data are: Source code, meta-data, build artifacts, information input and output.  
 
**Information System** - An organized assembly of resources and procedures for the collection, processing, maintenance, use, sharing, dissemination, or disposition of information. All systems, platforms, compute instances including and not limited to physical and virtual client endpoints, physical and virtual servers, software containers, databases, Internet of Things (IoT) devices, network devices, applications (internal and external), Serverless computing instances (i.e. AWS Lambda), vendor provided appliances, and third-party platforms, connected to the Capital Group network or used by Capital Group users or customers.

**Log** - a record of the events occurring within information systems and networks. Logs are composed of log entries; each entry contains information related to a specific event that has occurred within a system or network.

**Information** - communication or representation of knowledge such as facts, data, or opinions in any medium or form, including textual, numerical, graphic, cartographic, narrative, or audiovisual. 

**Cloud computing** - A model for enabling ubiquitous, convenient, on-demand network access to a shared pool of configurable computing resources (e.g., networks, servers, storage, applications, and services) that can be rapidly provisioned and released with minimal management effort or service provider interaction.

**Vulnerability**  - Weakness in an information system, system security procedures, internal controls, or implementation that could be exploited or triggered by a threat source. Note: The term weakness is synonymous for deficiency. Weakness may result in security and/or privacy risks.